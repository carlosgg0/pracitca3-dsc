services:
  zookeeper:
    image: zookeeper:3.9
    ports:
      - "2181:2181"
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "2181"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 10s

  # Servicio de la API (Pr√°ctica anterior)
  api:
    image: carlosgg0/practica2:parte1
    ports:
      - "8080:80" 
    environment:
      - REDIS_HOST=redis

  redis:
    image: redis
    ports:
      - "6379:6379"   

  app1:
    # App services could use carlosgg0/practica3:v1
    # which only supports zookeeper on standalone mode
    # (not cluster) 
    image: carlosgg0/practica3:v2 
    command: ["1"]
    environment:
      - ZOOKEEPER_HOST=zookeeper:2181
      - API_URL=http://api:80/nuevo
      - SAMPLING_PERIOD=5
    depends_on:
      zookeeper:
        condition: service_healthy
      api:
        condition: service_started

  app2:
    image: carlosgg0/practica3:v2
    command: ["2"]
    environment:
      - ZOOKEEPER_HOST=zookeeper:2181
      - API_URL=http://api:80/nuevo
      - SAMPLING_PERIOD=5
    depends_on:
      zookeeper:
        condition: service_healthy
      api:
        condition: service_started

  app3:
    image: carlosgg0/practica3:v2
    command: ["3"]
    environment:
      - ZOOKEEPER_HOST=zookeeper:2181
      - API_URL=http://api:80/nuevo
      - SAMPLING_PERIOD=5
    depends_on:
      zookeeper:
        condition: service_healthy
      api:
        condition: service_started